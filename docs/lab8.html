<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-01-06">

<title>432-2023 - Lab 8</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">432-2023</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./calendar.html">
 <span class="menu-text">Calendar</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./syllabus.html">
 <span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./notes.html">
 <span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./software.html">
 <span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/THOMASELOVE/432-data">
 <span class="menu-text">Data &amp; Code</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-labs" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Labs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-labs">    
        <li>
    <a class="dropdown-item" href="./lab1.html">
 <span class="dropdown-text">Lab 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab2.html">
 <span class="dropdown-text">Lab 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab3.html">
 <span class="dropdown-text">Lab 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab4.html">
 <span class="dropdown-text">Lab 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab5.html">
 <span class="dropdown-text">Lab 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab6.html">
 <span class="dropdown-text">Lab 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab7.html">
 <span class="dropdown-text">Lab 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lab8.html">
 <span class="dropdown-text">Lab 8</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="./projA.html">
 <span class="dropdown-text">Project A</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./projB.html">
 <span class="dropdown-text">Project B</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-quizzes" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Quizzes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-quizzes">    
        <li>
    <a class="dropdown-item" href="./quiz1.html">
 <span class="dropdown-text">Quiz 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./quiz2.html">
 <span class="dropdown-text">Quiz 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-important-links" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Important Links</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-important-links">    
        <li>
    <a class="dropdown-item" href="https://campuswire.com/">
 <span class="dropdown-text">Campuswire discussion board</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://canvas.case.edu/">
 <span class="dropdown-text">Canvas (submissions &amp; recordings)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://docs.google.com/document/d/1A6-P4TRXrCZVAqfDWw_s75lBGID9wHiaJjbsjltXojs/edit?usp=sharing">
 <span class="dropdown-text">Shared Google Drive (CWRU)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/THOMASELOVE/432-minute-2023">
 <span class="dropdown-text">Minute Papers (Github)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/THOMASELOVE/432-classes-2023">
 <span class="dropdown-text">Class READMEs (Github)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./contact.html">
 <span class="menu-text">Contact Us</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#general-instructions" id="toc-general-instructions" class="nav-link active" data-scroll-target="#general-instructions">General Instructions</a></li>
  <li><a href="#data-and-codebook-for-questions-1-2" id="toc-data-and-codebook-for-questions-1-2" class="nav-link" data-scroll-target="#data-and-codebook-for-questions-1-2">Data and Codebook for Questions 1-2</a></li>
  <li><a href="#question-1-10-points" id="toc-question-1-10-points" class="nav-link" data-scroll-target="#question-1-10-points">Question 1 (10 points)</a>
  <ul class="collapse">
  <li><a href="#hint-for-question-1" id="toc-hint-for-question-1" class="nav-link" data-scroll-target="#hint-for-question-1">Hint for Question 1</a></li>
  </ul></li>
  <li><a href="#question-2-10-points" id="toc-question-2-10-points" class="nav-link" data-scroll-target="#question-2-10-points">Question 2 (10 points)</a></li>
  <li><a href="#question-3-30-points" id="toc-question-3-30-points" class="nav-link" data-scroll-target="#question-3-30-points">Question 3 (30 points)</a></li>
  <li><a href="#our-best-advice" id="toc-our-best-advice" class="nav-link" data-scroll-target="#our-best-advice">Our Best Advice</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information">Session Information</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 8</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2023-01-06</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="general-instructions" class="level1">
<h1>General Instructions</h1>
<ul>
<li>Submit your work via <a href="https://canvas.case.edu/">Canvas</a>.</li>
<li>The deadline for this Lab is specified on the <a href="./calendar.html">Calendar</a>.
<ul>
<li>Work submitted late, but within 12 hours of the deadline will lose 5 of the available 50 points.</li>
<li>Work submitted more than 12 hours after the deadline will lose 10 of the available 50 points.</li>
</ul></li>
</ul>
<p>Your response should include a Quarto file (.qmd) and an HTML document that is the result of applying your Quarto file to the data we’ve provided. While we have not provided a specific template for this Lab, we encourage you to adapt the one provided for <a href="./lab2.html#template">Lab 2</a>.</p>
</section>
<section id="data-and-codebook-for-questions-1-2" class="level1">
<h1>Data and Codebook for Questions 1-2</h1>
<p>The <code>umaru.csv</code> data file found on <a href="https://github.com/THOMASELOVE/432-data">our 432-data page</a> contains information for 575 subjects selected from the UMARU IMPACT study collaborative project done by the University of Massachusetts AIDS Research Unit over 5 years (1989-1994). Various versions of this data set are frequently used in survival analysis texts. I’ve tweaked your data set enough that you’ll see some different results. The study included two concurrent randomized trials of residential treatment for drug abuse. The key question is to compare treatment programs of different planned durations in terms of their ability to reduce drug abuse and prevent high-risk HIV behavior. Here’s a codebook:</p>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 86%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><code>subject</code></td>
<td>Subject ID #, ranging from 1001 - 1575</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>age</code></td>
<td>age at enrollment, in years</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>beck</code></td>
<td>Beck Depression Score at admission</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>hercoc</code></td>
<td>heroin or cocaine use during the 3 months prior to admission (1 = Heroin &amp; Cocaine, 2 = Heroin only, 3 = Cocaine only, 4 = Neither Heroin nor Cocaine)</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>ivhx</code></td>
<td>IV drug use history at admission (1 = never, 2 = previous but not recent, 3 = recent)</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>ndrugtx</code></td>
<td># of prior drug treatments</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>race</code></td>
<td>subject’s race (0 = white, 1 = other)</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>treat</code></td>
<td>treatment randomization assignment (Long, or Short)</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>site</code></td>
<td>treatment site (A or B)</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>lot</code></td>
<td>Length of Treatment (Exit Date - Admission Date), in days</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>time</code></td>
<td>Time to Return to Drug Use (measured from Admission Date), in days</td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>censor</code></td>
<td>Returned to Drug Use indicator (1 = returned to drug use, 0 = otherwise)</td>
</tr>
</tbody>
</table>
</section>
<section id="question-1-10-points" class="level1">
<h1>Question 1 (10 points)</h1>
<p>Build a Cox model, using <code>treat</code> as a predictor, and spending degrees of freedom in any way you like with the rest of the available predictors (i.e.&nbsp;<em>everything but</em> <code>subject</code>, <code>lot</code>, <code>time</code> and <code>censor</code>) in the <code>umaru</code> data set, so long as you do not exceed a total of 12 degrees of freedom, predicting the time to return to drug use. You’ll probably want to use a Spearman rho-squared plot to make your selection, in which case you should stick with the model you develop using that tool, regardless of its eventual performance. Specify your model carefully, and interpret the hazard ratio for <code>treat</code> implied by your new model.</p>
<section id="hint-for-question-1" class="level2">
<h2 class="anchored" data-anchor-id="hint-for-question-1">Hint for Question 1</h2>
<p>When you build the Spearman <span class="math inline">\(\rho^2\)</span> plot, use <code>time</code> but not the entire survival object as the “outcome.”</p>
</section>
</section>
<section id="question-2-10-points" class="level1">
<h1>Question 2 (10 points)</h1>
<p>Assess the quality of fit from your model (be sure to use at least two different assessments of fit quality) and an assessment of adherence to the assumptions of a proportional hazards model to help justify your final selection. Validate the summary statistics describing your chosen model, and explain what those results mean in complete English8 sentences, too.</p>
</section>
<section id="question-3-30-points" class="level1">
<h1>Question 3 (30 points)</h1>
<p>Next, we will fit a model to the <code>hbp3456</code> data we first described and developed <a href="./lab2.html">in Lab 2</a>, predicting systolic blood pressure (<code>sbp</code>) using four variables: the subject’s age (<code>age</code>), weight (<code>weight</code>), LDL cholesterol level (<code>ldl</code>), and whether or not the subject is using an ACE-inhibitor or ARB medication (<code>acearb</code>). Throughout this question, annotate your R code with text so that it is very clear what you’re doing.</p>
<ol type="a">
<li><p>(5 points) Use <code>set.seed(2023)</code> and the <code>rsample</code> package to split the data into a training sample (called <code>hbp_train</code>) consisting of essentially 70% of the subjects, and a testing sample (called <code>hbp_test</code>) of the remaining 30% of the counties, while requiring a very similar distribution of <code>insurance</code> across the training and test samples.</p></li>
<li><p>(10 points) Build a recipe for pre-processing the predictors and establishing the roles of your variables in your model. For each model, be sure your recipe normalizes all predictors and uses indicator variables for any factors, using the training set of data. Create a workflow that uses the <code>lm</code> modeling engine for your model, then fit the model to the training sample. Then create a revised workflow that instead uses a Bayesian approach with <code>stan</code> to fit Model 2, using a seed of 2022 again, as well as a Student t distribution with 1 degree of freedom for the intercept term, and a Normal distribution with mean 0 and variance 4 for each of the predictors.</p></li>
<li><p>(5 points) Compare the coefficients of your <code>stan</code> fit for the model to the <code>lm</code> fit in a plot of the coefficients, with a 95% confidence interval for each. Write a couple of complete English sentences addressing what you see in the plot, and what conclusions you draw from it.</p></li>
<li><p>(10 points) Comparing the <code>lm</code> vs.&nbsp;the <code>stan</code> fit for the model you built earlier, assess out-of-sample performance in the testing data using three measures of predictive quality: the correlation-based R-square statistic, the root mean squared error and the mean absolute error. Produce an attractive table of the results for each model. Write a couple of complete English sentences describing your conclusions.</p></li>
</ol>
</section>
<section id="our-best-advice" class="level1">
<h1>Our Best Advice</h1>
<p>Review your HTML output file carefully before submission for copy-editing issues (spelling, grammar and syntax.) Even with spell-check in RStudio (just hit F7), it’s hard to find errors with these issues in your Quarto file so long as it is running. You really need to look closely at the resulting HTML output.</p>
</section>
<section id="session-information" class="level1">
<h1>Session Information</h1>
<p>Please display your session information at the end of your submission, as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.2 (2022-10-31 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 22621)

Locale:
  LC_COLLATE=English_United States.utf8 
  LC_CTYPE=English_United States.utf8   
  LC_MONETARY=English_United States.utf8
  LC_NUMERIC=C                          
  LC_TIME=English_United States.utf8    

Package version:
  base64enc_0.1.3   bslib_0.4.2       cachem_1.0.6      cli_3.5.0        
  compiler_4.2.2    digest_0.6.31     ellipsis_0.3.2    evaluate_0.19    
  fastmap_1.1.0     fs_1.5.2          glue_1.6.2        graphics_4.2.2   
  grDevices_4.2.2   highr_0.10        htmltools_0.5.4   htmlwidgets_1.6.0
  jquerylib_0.1.4   jsonlite_1.8.4    knitr_1.41        lifecycle_1.0.3  
  magrittr_2.0.3    memoise_2.0.1     methods_4.2.2     mime_0.12        
  R6_2.5.1          rappdirs_0.3.3    rlang_1.0.6       rmarkdown_2.19   
  rstudioapi_0.14   sass_0.4.4        stats_4.2.2       stringi_1.7.8    
  stringr_1.5.0     tinytex_0.43      tools_4.2.2       utils_4.2.2      
  vctrs_0.5.1       xfun_0.36         yaml_2.3.6       </code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>